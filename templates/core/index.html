{% extends 'base.html' %}
{% load static %}

{% block title %}{{ app_settings.app_name }} - {% if current_language == 'ar' %}أفضل كوبونات الخصم{% else %}Best Discount Coupons{% endif %}{% endblock %}

{% block content %}
<div class="container py-4">
    
    <!-- Hero Slider -->
    {% if slider_items %}
    <div class="hero-slider mb-4">
        <div class="swiper heroSwiper">
            <div class="swiper-wrapper">
                {% for item in slider_items %}
                <div class="swiper-slide" style="background: linear-gradient(135deg, {{ app_settings.primary_color|default:'#27ae60' }}, {{ app_settings.secondary_color|default:'#2c3e50' }}); {% if item.image %}background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('{{ item.image.url }}');{% endif %}">
                    <div class="slide-content">
                        <h2>{% if current_language == 'ar' %}{{ item.title }}{% else %}{{ item.title_en|default:item.title }}{% endif %}</h2>
                        <p class="mb-3">{% if current_language == 'ar' %}{{ item.subtitle }}{% else %}{{ item.subtitle_en|default:item.subtitle }}{% endif %}</p>
                        {% if item.link %}
                        <a href="{{ item.link }}" class="btn btn-light btn-lg">
                            {% if current_language == 'ar' %}{{ item.button_text }}{% else %}{{ item.button_text_en|default:item.button_text }}{% endif %}
                            <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>
    {% endif %}

    <!-- Search Box Mobile -->
    <div class="d-lg-none mb-4">
        <form action="{% url 'search' %}" method="GET" class="search-box w-100">
            <input type="text" name="q" placeholder="{% if current_language == 'ar' %}ابحث عن كوبون أو متجر...{% else %}Search for coupon or store...{% endif %}" class="form-control">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
    </div>

    <!-- Categories -->
    {% if categories %}
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">{% if current_language == 'ar' %}الأقسام{% else %}Categories{% endif %}</h2>
        </div>
        <div class="row g-3">
            {% for category in categories %}
            <div class="col-6 col-md-4 col-lg-3">
                <a href="{% url 'category_coupons' category.slug %}" class="text-decoration-none">
                    <div class="store-card">
                        {% if category.image %}
                        <img src="{{ category.image.url }}" alt="{{ category.name }}">
                        {% else %}
                        <i class="{{ category.icon|default:'fas fa-tag' }}" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 15px;"></i>
                        {% endif %}
                        <h6 class="text-dark">{% if current_language == 'ar' %}{{ category.name }}{% else %}{{ category.name_en|default:category.name }}{% endif %}</h6>
                        <small class="text-muted">{{ category.active_coupons_count }} {% if current_language == 'ar' %}كوبون{% else %}coupons{% endif %}</small>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Best Coupons -->
    {% if best_coupons %}
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">
                <i class="fas fa-star text-warning me-2"></i>
                {% if current_language == 'ar' %}أفضل الكوبونات{% else %}Best Coupons{% endif %}
            </h2>
            <a href="{% url 'coupons' %}?best=1" class="btn btn-outline-primary btn-sm">
                {% if current_language == 'ar' %}عرض الكل{% else %}View All{% endif %}
            </a>
        </div>
        <div class="row g-4">
            {% for coupon in best_coupons %}
            {% include 'includes/coupon_card.html' %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Featured Stores -->
    {% if featured_stores %}
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">
                <i class="fas fa-store text-primary me-2"></i>
                {% if current_language == 'ar' %}متاجر مميزة{% else %}Featured Stores{% endif %}
            </h2>
            <a href="{% url 'stores' %}" class="btn btn-outline-primary btn-sm">
                {% if current_language == 'ar' %}عرض الكل{% else %}View All{% endif %}
            </a>
        </div>
        <div class="row g-4">
            {% for store in featured_stores %}
            <div class="col-6 col-md-4 col-lg-3">
                <a href="{% url 'store_detail' store.slug %}" class="text-decoration-none">
                    <div class="store-card">
                        {% if store.logo %}
                        <img src="{{ store.logo.url }}" alt="{{ store.name }}">
                        {% else %}
                        <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-store fa-2x text-muted"></i>
                        </div>
                        {% endif %}
                        <h5>{% if current_language == 'ar' %}{{ store.name }}{% else %}{{ store.name_en|default:store.name }}{% endif %}</h5>
                        <span class="coupons-count">{{ store.active_coupons_count }} {% if current_language == 'ar' %}كوبون{% else %}coupons{% endif %}</span>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Most Used Coupons -->
    {% if most_used_coupons %}
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">
                <i class="fas fa-fire text-danger me-2"></i>
                {% if current_language == 'ar' %}الأكثر استخداماً{% else %}Most Used{% endif %}
            </h2>
            <a href="{% url 'coupons' %}?popular=1" class="btn btn-outline-primary btn-sm">
                {% if current_language == 'ar' %}عرض الكل{% else %}View All{% endif %}
            </a>
        </div>
        <div class="row g-4">
            {% for coupon in most_used_coupons %}
            {% include 'includes/coupon_card.html' %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Latest Coupons -->
    {% if latest_coupons %}
    <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-title">
                <i class="fas fa-clock text-info me-2"></i>
                {% if current_language == 'ar' %}أحدث الكوبونات{% else %}Latest Coupons{% endif %}
            </h2>
            <a href="{% url 'coupons' %}" class="btn btn-outline-primary btn-sm">
                {% if current_language == 'ar' %}عرض الكل{% else %}View All{% endif %}
            </a>
        </div>
        <div class="row g-4">
            {% for coupon in latest_coupons %}
            {% include 'includes/coupon_card.html' %}
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- App Download Section -->
    {% if app_settings.play_store_url or app_settings.app_store_url %}
    <section class="app-download">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="mb-2">{% if current_language == 'ar' %}حمّل تطبيقنا الآن{% else %}Download Our App Now{% endif %}</h3>
                <p class="mb-3 opacity-75">{% if current_language == 'ar' %}احصل على أفضل العروض والكوبونات مباشرة على هاتفك{% else %}Get the best deals and coupons directly on your phone{% endif %}</p>
                <div class="d-flex flex-wrap gap-2">
                    {% if app_settings.play_store_url %}
                    <a href="{{ app_settings.play_store_url }}" target="_blank">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Google Play" height="50">
                    </a>
                    {% endif %}
                    {% if app_settings.app_store_url %}
                    <a href="{{ app_settings.app_store_url }}" target="_blank">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg" alt="App Store" height="50">
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-4 text-center d-none d-lg-block">
                <i class="fas fa-mobile-alt" style="font-size: 5rem; opacity: 0.5;"></i>
            </div>
        </div>
    </section>
    {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize Hero Slider
    var heroSwiper = new Swiper(".heroSwiper", {
        loop: true,
        autoplay: {
            delay: 5000,
            disableOnInteraction: false,
        },
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
    });
</script>
{% endblock %}